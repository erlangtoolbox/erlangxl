%define realname strikead-erlang-commons
Summary:        StrikeAd Erlang lib
Name:           strikead-erlang-commons
Version:        {{VERSION}}
License:        Erlang Public License
Release:        1
Requires:       erlang yaws erlang-flake erlang-erleveldb
BuildRequires:  erlang erlang-ktuo strikead-erlang-erlando yaws
Group:          StrikeAd/Software
Source:         %{name}-%{version}.tar.gz
BuildRoot:      %{_tmppath}/%{name}-%{version}-root

%define erl_lib_root /usr/%{_lib}/erlang/lib

%description
StrikeAd Erlang common library

%prep
%setup -n erlang-commons

%build
make

%install

common_vsn=`./version.sh`

apps="strikead_stdlib \
	strikead_json \
	strikead_leveldb \
	strikead_yaws \
	strikead_csv \
	strikead_eunit \
	strikead_io \
	strikead_net \
	persist"

for app in $apps; do
    %{__mkdir} -p %{buildroot}%{erl_lib_root}/$app-$common_vsn/ebin;
    for f in $app/ebin/*; do
	%{__install} $f %{buildroot}%{erl_lib_root}/$app-$common_vsn/ebin/`basename $f`;
    done
    if [ -d $app/include ]; then
	%{__mkdir} -p %{buildroot}%{erl_lib_root}/$app-$common_vsn/include;
        for i in $app/include/*; do
            %{__install} $i %{buildroot}%{erl_lib_root}/$app-$common_vsn/include/`basename $i`;
        done
    fi
done

%Clean
%{__rm} -rf %{buildroot}

%files
%defattr(-,root,root)
%{erl_lib_root}/*/ebin/*
%{erl_lib_root}/*/include/*

%changelog
* Fri Aug 17 2012 andrei.zavada@strikead.com
- Use version.sh
* Mon Aug 13 2012 andrei.zavada@strikead.com
- Separate installs of individual applications
- Move erlando and ktuo to BuildDepends
* Tue Aug  7 2012 andrei.zavada@strikead.com
- Initial package for OpenSUSE
